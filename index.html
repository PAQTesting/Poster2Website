<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Poster to Website Converter</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><text y=%221em%22 font-size=%2216%22>üñ•Ô∏è</text></svg>">
    <!-- Add PDF.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script>
        // Configure PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            min-height: 100vh;
        }

        /* Container Styles */
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .app-header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .app-header h1 {
            font-size: 36px;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .app-header p {
            font-size: 18px;
            color: #666;
        }

        /* Header Icons */
        .header-icons {
            position: absolute;
            top: 0;
            right: 0;
            display: flex;
            gap: 10px;
        }

        .icon-button {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 20px;
        }

        .icon-button:hover {
            background: #e0e0e0;
            transform: translateY(-1px);
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            margin-bottom: 40px;
            padding: 0 20px;
            gap: 20px;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            flex: 0 0 auto;
            width: 120px;
        }

        .step-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #e0e0e0;
            color: #999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            transition: all 0.3s;
            margin-bottom: 8px;
        }

        .step.active .step-circle {
            background: #3498db;
            color: white;
            transform: scale(1.1);
        }

        .step.complete .step-circle {
            background: #27ae60;
            color: white;
        }

        .step-label {
            font-size: 14px;
            color: #666;
            text-align: center;
            line-height: 1.3;
        }

        .step-connector {
            position: absolute;
            top: 25px;
            left: 70px;
            width: 90px;
            height: 2px;
            background: #e0e0e0;
            z-index: -1;
        }

        .step.complete .step-connector {
            background: #27ae60;
        }

        .step:last-child .step-connector {
            display: none;
        }

        /* Upload Area Styles */
        .upload-section {
            background: white;
            border-radius: 12px;
            padding: 60px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 40px;
            transition: all 0.3s ease;
        }

        .upload-area {
            border: 3px dashed #3498db;
            border-radius: 12px;
            padding: 80px 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .upload-area:hover {
            border-color: #2980b9;
            background: #e8f4f8;
        }

        .upload-area.dragging {
            border-color: #27ae60;
            background: #e8f8e8;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 72px;
            color: #3498db;
            margin-bottom: 20px;
        }

        .upload-text h2 {
            font-size: 24px;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .upload-text p {
            color: #666;
            font-size: 16px;
        }

        .supported-formats {
            margin-top: 20px;
            font-size: 14px;
            color: #999;
        }

        /* Editor Section */
        .editor-section {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: none;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .editor-tabs {
            display: flex;
            gap: 20px;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            color: #666;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-button.active {
            color: #3498db;
            border-bottom-color: #3498db;
        }

        .editor-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .form-section {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 20px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Color Picker Group */
        .color-picker-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .color-picker-group input[type="color"] {
            width: 60px;
            height: 40px;
            padding: 2px;
            cursor: pointer;
        }

        .color-picker-group input[type="text"] {
            flex: 1;
        }

        /* Section Editor */
        .section-editor {
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s;
            overflow: hidden;
        }

        .section-editor.detail-section {
            background: #f0f8ff;
            border-color: #b8daff;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            cursor: pointer;
            user-select: none;
            background: rgba(255, 255, 255, 0.5);
        }

        .section-header:hover {
            background: rgba(255, 255, 255, 0.8);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            font-size: 24px;
        }

        .section-editor h4 {
            margin: 0;
            color: #2c3e50;
        }

        .section-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .collapse-indicator {
            font-size: 14px;
            color: #666;
            margin-right: 10px;
        }

        /* Arrow buttons for reordering */
        .arrow-button {
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .arrow-button:hover:not(:disabled) {
            background: #e0e0e0;
            border-color: #999;
        }

        .arrow-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Section content */
        .section-content {
            padding: 0 20px 20px;
            display: none;
        }

        .section-content.expanded {
            display: block;
        }

        /* Rich text editor toolbar */
        .text-toolbar {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
            flex-wrap: wrap;
        }

        .toolbar-button {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 16px;
        }

        .toolbar-button:hover {
            background: #e8f4f8;
            border-color: #3498db;
        }

        .toolbar-button.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .toolbar-separator {
            width: 1px;
            background: #ddd;
            margin: 0 5px;
        }

        /* Icon Picker */
        .icon-picker {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
            margin-top: 10px;
            padding: 10px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .icon-option {
            padding: 8px;
            text-align: center;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
            font-size: 20px;
        }

        .icon-option:hover {
            background: #e8f4f8;
        }

        .icon-option.selected {
            background: #3498db;
        }

        /* Image Upload */
        .image-upload-area {
            border: 2px dashed #ddd;
            border-radius: 6px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .image-upload-area:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }

        .section-image-preview {
            margin-top: 10px;
            text-align: center;
        }

        .section-image-preview img {
            border-radius: 6px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* Image size buttons */
        .image-size-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }

        .size-button {
            background: #f0f0f0;
            border: 1px solid #ddd;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .size-button:hover {
            background: #e0e0e0;
        }

        .size-button.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        /* Website Preview */
        .website-preview {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .browser-bar {
            background: #f5f5f5;
            padding: 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .browser-dots {
            display: flex;
            gap: 6px;
        }

        .browser-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ddd;
        }

        .browser-dot:nth-child(1) { background: #ff5f57; }
        .browser-dot:nth-child(2) { background: #ffbd2e; }
        .browser-dot:nth-child(3) { background: #28ca42; }

        .preview-url {
            flex: 1;
            text-align: center;
            color: #999;
        }

        .website-iframe {
            width: 100%;
            flex: 1;
            border: none;
            background: white;
        }

        /* Full preview modal with device selector */
        .preview-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .device-selector {
            padding: 15px;
            background: #f5f5f5;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .device-button {
            background: white;
            border: 1px solid #ddd;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }

        .device-button:hover {
            background: #f5f5f5;
        }

        .device-button.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .preview-frame-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: #e5e5e5;
            overflow: auto;
        }

        .preview-frame {
            background: white;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .preview-frame.desktop {
            width: 100%;
            max-width: 1200px;
            height: 90%;
        }

        .preview-frame.tablet {
            width: 1024px;
            height: 768px;
        }

        .preview-frame.mobile {
            width: 375px;
            height: 667px;
        }

        /* Font size range controls */
        .range-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .range-group input[type="range"] {
            flex: 1;
        }

        .range-value {
            min-width: 50px;
            text-align: right;
            font-weight: 600;
            color: #3498db;
        }

        /* Buttons */
        .button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .button:hover {
            background: #2980b9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .button.secondary {
            background: #95a5a6;
        }

        .button.secondary:hover {
            background: #7f8c8d;
        }

        .button.success {
            background: #27ae60;
        }

        .button.success:hover {
            background: #229954;
        }

        .button.danger {
            background: #e74c3c;
            padding: 8px 16px;
            font-size: 14px;
        }

        .button.danger:hover {
            background: #c0392b;
        }

        .button.small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .button-group {
            display: flex;
            gap: 15px;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-content.large {
            max-width: 95%;
            height: 95vh;
            display: flex;
            flex-direction: column;
        }

        .close-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: #999;
            z-index: 10;
        }

        .close-button:hover {
            color: #666;
        }

        /* Info modal content */
        .info-content {
            margin-top: 20px;
        }

        .info-section {
            margin-bottom: 30px;
        }

        .info-section h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .info-steps {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .info-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .info-step-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }

        /* Hidden file input */
        input[type="file"] {
            display: none;
        }

        /* Header Fields */
        .header-fields {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #b8daff;
        }

        .header-fields h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        /* Logo Preview */
        .logo-preview {
            max-width: 150px;
            max-height: 80px;
            margin-top: 10px;
        }

        .logo-preview img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        /* Layout Info */
        .layout-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="app-header">
            <h1>Medical Poster to Website Converter</h1>
            <p>Transform your medical conference posters into professional websites in minutes</p>
            <div class="header-icons">
                <button class="icon-button" onclick="goHome()" title="Home">
                    <span>üè†</span>
                </button>
                <button class="icon-button" onclick="showInfo()" title="Info">
                    <span>‚ÑπÔ∏è</span>
                </button>
            </div>
        </div>

        <!-- Progress Steps -->
        <div class="progress-steps">
            <div class="step active" id="step1">
                <div class="step-circle">1</div>
                <span class="step-label">Upload<br>Poster</span>
                <div class="step-connector"></div>
            </div>
            <div class="step" id="step2">
                <div class="step-circle">2</div>
                <span class="step-label">Process<br>File</span>
                <div class="step-connector"></div>
            </div>
            <div class="step" id="step3">
                <div class="step-circle">3</div>
                <span class="step-label">Edit &<br>Preview</span>
                <div class="step-connector"></div>
            </div>
            <div class="step" id="step4">
                <div class="step-circle">4</div>
                <span class="step-label">Export<br>Website</span>
            </div>
        </div>

        <!-- Upload Section -->
        <div class="upload-section" id="uploadSection">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üìÑ</div>
                <div class="upload-text">
                    <h2>Upload Your Medical Poster</h2>
                    <p>Drag & drop or click to browse</p>
                </div>
                <div class="supported-formats">
                    Supported formats: PDF, PNG, JPG, JPEG
                </div>
            </div>
            <input type="file" id="fileInput" accept=".pdf,.png,.jpg,.jpeg">
        </div>

        <!-- Editor Section -->
        <div class="editor-section" id="editorSection">
            <div class="editor-header">
                <div class="editor-tabs">
                    <button class="tab-button active" data-tab="sections">Sections</button>
                    <button class="tab-button" data-tab="design">Design</button>
                </div>
                <div class="button-group">
                    <button class="button secondary" onclick="showPreviewModal()">
                        üëÅ Full Preview
                    </button>
                    <button class="button success" onclick="exportWebsite()">
                        üíæ Export Website Code
                    </button>
                </div>
            </div>

            <div class="editor-content">
                <!-- Form Section -->
                <div class="form-section">
                    <!-- Sections Tab -->
                    <div id="sectionsTab" class="tab-content">
                        <div class="header-fields">
                            <h3>üìã Header Information</h3>
                            <div class="form-group">
                                <label>Poster Title</label>
                                <textarea id="posterTitle" placeholder="Enter the main title of your poster"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Authors</label>
                                <textarea id="posterAuthors" placeholder="Author names"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Affiliations</label>
                                <textarea id="posterAffiliations" placeholder="Institutional affiliations"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Conference Details</label>
                                <input type="text" id="conferenceDetails" placeholder="e.g., PNS 2025 | Edinburgh, UK">
                            </div>
                        </div>

                        <h3 style="margin-bottom: 15px;">üìë Content Sections</h3>
                        <p style="margin-bottom: 15px; color: #666; font-size: 14px;">
                            Click on a section header to expand/collapse. Use the arrow buttons to reorder sections.
                        </p>
                        <div id="sectionsContainer">
                            <!-- Dynamic sections will be added here -->
                        </div>
                        <button class="button secondary" onclick="addSection()" style="margin-top: 20px;">
                            + Add Section
                        </button>
                    </div>

                    <!-- Design Tab -->
                    <div id="designTab" class="tab-content" style="display: none;">
                        <div class="form-group">
                            <label>Logo/Image</label>
                            <input type="file" id="logoInput" accept="image/*" onchange="handleLogoUpload(event)">
                            <button class="button secondary" onclick="document.getElementById('logoInput').click()">
                                üì∑ Upload Logo
                            </button>
                            <div id="logoPreview" class="logo-preview"></div>
                        </div>
                        <div class="form-group" id="logoSizeGroup" style="display: none;">
                            <label>Logo Size</label>
                            <div class="range-group">
                                <input type="range" id="logoSize" min="50" max="200" value="80" onchange="updatePreview()">
                                <span class="range-value" id="logoSizeValue">80px</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Color Scheme</label>
                            <select id="colorScheme" onchange="updateColorScheme()">
                                <option value="clinical">Clinical Blue</option>
                                <option value="research">Research Green</option>
                                <option value="pharma">Pharma Purple</option>
                                <option value="modern">Modern Teal</option>
                                <option value="academic">Academic Red</option>
                                <option value="custom">Custom Colors</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Primary Color</label>
                            <div class="color-picker-group">
                                <input type="color" id="primaryColor" value="#3498db" onchange="updatePreview()">
                                <input type="text" id="primaryColorHex" value="#3498db" onchange="updatePreview()">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Secondary Color</label>
                            <div class="color-picker-group">
                                <input type="color" id="secondaryColor" value="#2c3e50" onchange="updatePreview()">
                                <input type="text" id="secondaryColorHex" value="#2c3e50" onchange="updatePreview()">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Font Style</label>
                            <select id="fontStyle" onchange="updatePreview()">
                                <option value="professional">Professional (Sans-serif)</option>
                                <option value="academic">Academic (Serif)</option>
                                <option value="modern">Modern (Inter)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Section Title Size</label>
                            <div class="range-group">
                                <input type="range" id="sectionTitleSize" min="20" max="48" value="32" onchange="updatePreview()">
                                <span class="range-value" id="sectionTitleSizeValue">32px</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Section Content Size</label>
                            <div class="range-group">
                                <input type="range" id="sectionContentSize" min="14" max="24" value="18" onchange="updatePreview()">
                                <span class="range-value" id="sectionContentSizeValue">18px</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Layout Style</label>
                            <select id="layoutStyle" onchange="updatePreview()">
                                <option value="single">Single Page Scroll</option>
                                <option value="sections">Section Navigation</option>
                            </select>
                            <div class="layout-info">
                                <strong>Single Page:</strong> Traditional scrolling website<br>
                                <strong>Section Navigation:</strong> Fixed navigation menu with section links
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Website Preview -->
                <div class="website-preview">
                    <div class="browser-bar">
                        <div class="browser-dots">
                            <div class="browser-dot"></div>
                            <div class="browser-dot"></div>
                            <div class="browser-dot"></div>
                        </div>
                        <div class="preview-url">
                            Preview: your-poster-website.com
                        </div>
                    </div>
                    <iframe class="website-iframe" id="websitePreview"></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3 id="loadingTitle">Processing your poster...</h3>
            <p id="loadingMessage">This may take a moment</p>
        </div>
    </div>

    <!-- Info Modal -->
    <div class="modal" id="infoModal">
        <div class="modal-content">
            <button class="close-button" onclick="closeInfo()">√ó</button>
            <h2>How to Use the Medical Poster Converter</h2>
            
            <div class="info-content">
                <div class="info-section">
                    <h3>üöÄ Quick Start Guide</h3>
                    <div class="info-steps">
                        <div class="info-step">
                            <div class="info-step-number">1</div>
                            <div>
                                <strong>Upload Your Poster</strong><br>
                                Drag and drop or click to upload your PDF or image file
                            </div>
                        </div>
                        <div class="info-step">
                            <div class="info-step-number">2</div>
                            <div>
                                <strong>Review Extracted Content</strong><br>
                                The app will extract text from your poster and organize it into sections
                            </div>
                        </div>
                        <div class="info-step">
                            <div class="info-step-number">3</div>
                            <div>
                                <strong>Edit and Customize</strong><br>
                                Edit text with formatting options, reorder sections with arrows, add images, and customize design
                            </div>
                        </div>
                        <div class="info-step">
                            <div class="info-step-number">4</div>
                            <div>
                                <strong>Export Your Website</strong><br>
                                Download as HTML, React component, or Next.js page
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>‚ú® Key Features</h3>
                    <ul style="line-height: 1.8; color: #666;">
                        <li><strong>PDF Text Extraction:</strong> Automatically extracts content from PDF posters</li>
                        <li><strong>Section Management:</strong> Collapsible sections with easy arrow reordering</li>
                        <li><strong>Rich Text Editing:</strong> Format text with bold, italic, underline, and lists</li>
                        <li><strong>Custom Icons:</strong> Choose from various medical and scientific icons</li>
                        <li><strong>Image Support:</strong> Add images to any section</li>
                        <li><strong>Responsive Preview:</strong> Full preview with desktop, tablet, and mobile views</li>
                        <li><strong>Multiple Export Formats:</strong> Export as standalone HTML, React, or Next.js</li>
                        <li><strong>Custom Styling:</strong> Choose color schemes, fonts, and text sizes</li>
                    </ul>
                </div>

                <div class="info-section">
                    <h3>üí° Tips</h3>
                    <ul style="line-height: 1.8; color: #666;">
                        <li>For best results, use high-quality PDFs with selectable text</li>
                        <li>Click section headers to expand/collapse for easier navigation</li>
                        <li>Use the formatting toolbar to enhance your text</li>
                        <li>Preview your site on different devices before exporting</li>
                        <li>Section Navigation layout creates a fixed top menu for easy navigation</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div class="modal" id="previewModal">
        <div class="modal-content large">
            <button class="close-button" onclick="closePreviewModal()">√ó</button>
            <h2 style="margin-bottom: 20px;">Full Website Preview</h2>
            <div class="preview-container">
                <div class="device-selector">
                    <button class="device-button active" onclick="setPreviewDevice('desktop')">
                        üíª Desktop
                    </button>
                    <button class="device-button" onclick="setPreviewDevice('tablet')">
                        üì± Tablet (Landscape)
                    </button>
                    <button class="device-button" onclick="setPreviewDevice('mobile')">
                        üì± Mobile
                    </button>
                </div>
                <div class="preview-frame-container">
                    <div class="preview-frame desktop" id="previewFrame">
                        <iframe style="width: 100%; height: 100%; border: none;" id="fullPreview"></iframe>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <button class="close-button" onclick="closeExportModal()">√ó</button>
            <h2>Export Website Code</h2>
            <p style="margin: 20px 0;">Choose your export format:</p>
            <div style="margin: 20px 0;">
                <label style="display: block; padding: 15px; margin-bottom: 10px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer;">
                    <input type="radio" name="exportFormat" value="html" checked> 
                    <strong>Standalone HTML</strong> - Single file ready to deploy
                </label>
                <label style="display: block; padding: 15px; margin-bottom: 10px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer;">
                    <input type="radio" name="exportFormat" value="react"> 
                    <strong>React Component</strong> - Modern React with hooks
                </label>
                <label style="display: block; padding: 15px; margin-bottom: 10px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer;">
                    <input type="radio" name="exportFormat" value="nextjs"> 
                    <strong>Next.js Page</strong> - SSR with SEO optimization
                </label>
            </div>
            <div class="button-group" style="justify-content: space-between;">
                <button class="button secondary" onclick="closeExportModal()">Cancel</button>
                <button class="button success" onclick="downloadWebsite()">Download Code</button>
            </div>
        </div>
    </div>

    <script>
        // Available icons for sections
        const availableIcons = ['üî¨', 'üß™', 'üìä', 'üí°', 'üéØ', 'üìà', 'üß¨', 'üíä', 'üîç', 'üìã', 'üè•', '‚öïÔ∏è', 'üß´', 'ü©∫', 'üìê', 'üíâ'];

        // State management
        let extractedData = {
            title: '',
            authors: '',
            affiliations: '',
            conference: '',
            sections: [],
            logo: null,
            logoSize: 80,
            primaryColor: '#3498db',
            secondaryColor: '#2c3e50',
            fontStyle: 'professional',
            layoutStyle: 'single',
            sectionTitleSize: 32,
            sectionContentSize: 18
        };

        let currentStep = 1;
        let uploadedFile = null;
        let currentDevice = 'desktop';

        // Track expanded sections
        let expandedSections = {};

        // Color schemes
        const colorSchemes = {
            clinical: { primary: '#3498db', secondary: '#2c3e50' },
            research: { primary: '#27ae60', secondary: '#16a085' },
            pharma: { primary: '#8e44ad', secondary: '#6c3483' },
            modern: { primary: '#17a2b8', secondary: '#138496' },
            academic: { primary: '#e74c3c', secondary: '#c0392b' },
            custom: { primary: '#3498db', secondary: '#2c3e50' }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupFileUpload();
            setupTabs();
            setupFontSizeControls();
            updatePreview();
        });

        // Setup font size controls
        function setupFontSizeControls() {
            const titleSlider = document.getElementById('sectionTitleSize');
            const contentSlider = document.getElementById('sectionContentSize');
            const logoSlider = document.getElementById('logoSize');
            
            titleSlider.addEventListener('input', function() {
                document.getElementById('sectionTitleSizeValue').textContent = this.value + 'px';
                extractedData.sectionTitleSize = parseInt(this.value);
            });
            
            contentSlider.addEventListener('input', function() {
                document.getElementById('sectionContentSizeValue').textContent = this.value + 'px';
                extractedData.sectionContentSize = parseInt(this.value);
            });
            
            logoSlider.addEventListener('input', function() {
                document.getElementById('logoSizeValue').textContent = this.value + 'px';
                extractedData.logoSize = parseInt(this.value);
            });
        }

        // File Upload Setup
        function setupFileUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');

            // Click to upload
            uploadArea.addEventListener('click', () => fileInput.click());

            // File input change
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });

            // Drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragging');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragging');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragging');
                if (e.dataTransfer.files.length > 0) {
                    handleFileUpload(e.dataTransfer.files[0]);
                }
            });
        }

        // Tab Setup
        function setupTabs() {
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
        }

        function switchTab(tabName) {
            // Update buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-tab') === tabName) {
                    btn.classList.add('active');
                }
            });

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById(tabName + 'Tab').style.display = 'block';
        }

        // File Upload Handler
        function handleFileUpload(file) {
            const validTypes = ['application/pdf', 'image/png', 'image/jpeg', 'image/jpg'];
            
            if (!validTypes.includes(file.type)) {
                alert('Please upload a PDF or image file (PNG, JPG, JPEG)');
                return;
            }

            uploadedFile = file;
            processFile(file);
        }

        // Process uploaded file
        async function processFile(file) {
            updateStep(2);
            showLoading(true);

            if (file.type === 'application/pdf' && typeof pdfjsLib !== 'undefined') {
                await extractPDFContent(file);
            } else if (file.type.startsWith('image/')) {
                // For images, we can't extract text, so provide empty template
                setTimeout(() => {
                    createEmptyTemplate();
                    showLoading(false);
                    showEditor();
                    alert('Image uploaded successfully! Since text cannot be extracted from images, please manually enter your poster content in the editor.');
                }, 1500);
            } else {
                // Fallback
                setTimeout(() => {
                    createEmptyTemplate();
                    showLoading(false);
                    showEditor();
                }, 1500);
            }
        }

        // Extract PDF content
        async function extractPDFContent(file) {
            try {
                document.getElementById('loadingTitle').textContent = 'Extracting PDF Content...';
                document.getElementById('loadingMessage').textContent = 'Reading PDF file...';
                
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                
                let fullText = '';
                const totalPages = pdf.numPages;
                
                // Extract text from each page
                for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
                    document.getElementById('loadingMessage').textContent = `Extracting page ${pageNum} of ${totalPages}...`;
                    
                    const page = await pdf.getPage(pageNum);
                    const textContent = await page.getTextContent();
                    
                    // Process text items
                    let pageText = '';
                    let lastY = null;
                    let currentLine = '';
                    let lines = [];
                    
                    // Sort items by Y position then X position
                    const sortedItems = textContent.items.sort((a, b) => {
                        const yDiff = b.transform[5] - a.transform[5];
                        if (Math.abs(yDiff) > 2) return yDiff;
                        return a.transform[4] - b.transform[4];
                    });
                    
                    sortedItems.forEach((item) => {
                        const text = item.str;
                        if (!text || !text.trim()) return;
                        
                        const currentY = item.transform[5];
                        
                        if (lastY !== null && Math.abs(currentY - lastY) > 2) {
                            if (currentLine.trim()) {
                                lines.push(currentLine.trim());
                            }
                            currentLine = text;
                        } else {
                            if (currentLine && !currentLine.endsWith(' ') && !text.startsWith(' ')) {
                                currentLine += ' ';
                            }
                            currentLine += text;
                        }
                        
                        lastY = currentY;
                    });
                    
                    if (currentLine.trim()) {
                        lines.push(currentLine.trim());
                    }
                    
                    pageText = lines.join('\n');
                    fullText += pageText + '\n\n';
                }
                
                document.getElementById('loadingMessage').textContent = 'Analyzing content...';
                
                // Parse the extracted text
                parseExtractedText(fullText);
                
                setTimeout(() => {
                    showLoading(false);
                    populateForm();
                    showEditor();
                    
                    const sectionsFound = extractedData.sections.filter(s => s.content).length;
                    alert(`PDF content extracted successfully!\n\nFound ${sectionsFound} sections with content.\n\nPlease review and edit the extracted information as needed.`);
                }, 1000);
                
            } catch (error) {
                console.error('Error extracting PDF:', error);
                showLoading(false);
                createEmptyTemplate();
                showEditor();
                alert('Unable to extract text from this PDF. This might be an image-based PDF. Please manually enter your poster content in the editor.');
            }
        }

        // Parse extracted text into sections
        function parseExtractedText(text) {
            const lines = text.split('\n').map(line => line.trim()).filter(line => line);
            
            // Try to find title (usually one of the first substantial lines)
            extractedData.title = '';
            for (let i = 0; i < Math.min(5, lines.length); i++) {
                if (lines[i].length > 20 && lines[i].length < 200 && !lines[i].includes(',')) {
                    extractedData.title = lines[i];
                    break;
                }
            }
            
            // Look for authors (lines with commas)
            extractedData.authors = '';
            const titleIndex = lines.findIndex(line => line === extractedData.title);
            if (titleIndex !== -1) {
                for (let i = titleIndex + 1; i < Math.min(titleIndex + 10, lines.length); i++) {
                    if (lines[i].includes(',') && lines[i].length > 20) {
                        extractedData.authors = lines[i];
                        break;
                    }
                }
            }
            
            // Look for affiliations
            const institutionKeywords = /university|hospital|institute|center|department|school|college|clinic|laboratory/i;
            const affiliationLines = lines.filter(line => 
                institutionKeywords.test(line) && line.length > 20
            ).slice(0, 3);
            extractedData.affiliations = affiliationLines.join('; ');
            
            // Look for conference info
            const conferenceKeywords = /presented at|conference|meeting|symposium|congress|annual|poster/i;
            const conferenceLine = lines.find(line => 
                conferenceKeywords.test(line) && line.length > 20
            );
            extractedData.conference = conferenceLine || '';
            
            // Extract sections
            const sectionKeywords = [
                { keywords: /abstract/i, title: 'Abstract', icon: 'üìÑ' },
                { keywords: /introduction|background/i, title: 'Background', icon: 'üî¨' },
                { keywords: /objective|aim|purpose|goal/i, title: 'Objectives', icon: 'üéØ' },
                { keywords: /method/i, title: 'Methods', icon: 'üß™' },
                { keywords: /result/i, title: 'Results', icon: 'üìä' },
                { keywords: /discussion/i, title: 'Discussion', icon: 'üí≠' },
                { keywords: /conclusion/i, title: 'Conclusions', icon: 'üí°' },
                { keywords: /reference/i, title: 'References', icon: 'üìö' }
            ];
            
            extractedData.sections = [];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                
                for (const { keywords, title, icon } of sectionKeywords) {
                    if (keywords.test(line)) {
                        // Extract content after section header
                        let content = '';
                        let j = i + 1;
                        
                        while (j < lines.length && j < i + 30) {
                            const nextLine = lines[j];
                            
                            // Check if we hit another section
                            const isNewSection = sectionKeywords.some(sk => sk.keywords.test(nextLine));
                            if (isNewSection) break;
                            
                            if (nextLine.length > 10) {
                                content += nextLine + '\n';
                            }
                            j++;
                        }
                        
                        if (content.trim()) {
                            extractedData.sections.push({
                                id: Date.now() + Math.random(),
                                title: title,
                                content: content.trim(),
                                icon: icon,
                                image: null,
                                imageSize: 'medium'
                            });
                        }
                        break;
                    }
                }
            }
            
            // If no sections found, create empty template
            if (extractedData.sections.length === 0) {
                createDefaultSections();
            }
            
            // Set all sections as expanded by default
            extractedData.sections.forEach(section => {
                expandedSections[section.id] = true;
            });
        }

        // Create empty template
        function createEmptyTemplate() {
            extractedData = {
                title: '',
                authors: '',
                affiliations: '',
                conference: '',
                sections: [],
                logo: null,
                primaryColor: '#3498db',
                secondaryColor: '#2c3e50',
                fontStyle: 'professional',
                layoutStyle: 'single',
                sectionTitleSize: 32,
                sectionContentSize: 18
            };
            createDefaultSections();
        }

        // Create default sections
        function createDefaultSections() {
            extractedData.sections = [
                {
                    id: Date.now(),
                    title: 'Background',
                    content: '',
                    icon: 'üî¨',
                    image: null,
                    imageSize: 'medium'
                },
                {
                    id: Date.now() + 1,
                    title: 'Methods',
                    content: '',
                    icon: 'üß™',
                    image: null,
                    imageSize: 'medium'
                },
                {
                    id: Date.now() + 2,
                    title: 'Results',
                    content: '',
                    icon: 'üìä',
                    image: null,
                    imageSize: 'medium'
                },
                {
                    id: Date.now() + 3,
                    title: 'Conclusions',
                    content: '',
                    icon: 'üí°',
                    image: null,
                    imageSize: 'medium'
                }
            ];
            
            // Set all sections as expanded by default
            extractedData.sections.forEach(section => {
                expandedSections[section.id] = true;
            });
        }

        // Populate form with extracted data
        function populateForm() {
            document.getElementById('posterTitle').value = extractedData.title;
            document.getElementById('posterAuthors').value = extractedData.authors;
            document.getElementById('posterAffiliations').value = extractedData.affiliations;
            document.getElementById('conferenceDetails').value = extractedData.conference;
            
            populateSections();
        }

        // Toggle section expansion
        function toggleSection(sectionId) {
            expandedSections[sectionId] = !expandedSections[sectionId];
            const sectionContent = document.querySelector(`[data-section-content="${sectionId}"]`);
            const indicator = document.querySelector(`[data-indicator="${sectionId}"]`);
            
            if (expandedSections[sectionId]) {
                sectionContent.classList.add('expanded');
                indicator.textContent = '‚ñº';
            } else {
                sectionContent.classList.remove('expanded');
                indicator.textContent = '‚ñ∂';
            }
        }

        // Populate sections with accordion functionality
        function populateSections() {
            const container = document.getElementById('sectionsContainer');
            container.innerHTML = '';
            
            extractedData.sections.forEach((section, index) => {
                addSectionElement(section, index);
            });
        }

        // Rich text formatting functions
        function formatText(sectionId, format) {
            const textarea = document.getElementById(`sectionContent-${sectionId}`);
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            if (selectedText) {
                let formattedText = '';
                switch(format) {
                    case 'bold':
                        formattedText = `<b>${selectedText}</b>`;
                        break;
                    case 'italic':
                        formattedText = `<i>${selectedText}</i>`;
                        break;
                    case 'underline':
                        formattedText = `<u>${selectedText}</u>`;
                        break;
                }
                
                const newText = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
                textarea.value = newText;
                updateSection(sectionId, 'content', newText);
            }
        }

        function insertList(sectionId, type) {
            const textarea = document.getElementById(`sectionContent-${sectionId}`);
            const cursorPos = textarea.selectionStart;
            const textBefore = textarea.value.substring(0, cursorPos);
            const textAfter = textarea.value.substring(cursorPos);
            
            let listItem = type === 'bullet' ? '\n‚Ä¢ ' : '\n1. ';
            const newText = textBefore + listItem + textAfter;
            textarea.value = newText;
            
            // Set cursor position after the list marker
            const newCursorPos = cursorPos + listItem.length;
            textarea.setSelectionRange(newCursorPos, newCursorPos);
            textarea.focus();
            
            updateSection(sectionId, 'content', newText);
        }

        // Add section element with accordion and rich text
        function addSectionElement(section, index) {
            const container = document.getElementById('sectionsContainer');
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'section-editor';
            sectionDiv.dataset.sectionId = section.id;
            
            const isFirst = index === 0;
            const isLast = index === extractedData.sections.length - 1;
            const isExpanded = expandedSections[section.id] !== false;
            
            sectionDiv.innerHTML = `
                <div class="section-header" onclick="toggleSection(${section.id})">
                    <div class="section-title">
                        <span class="section-icon" id="icon-${section.id}">${section.icon || 'üìÑ'}</span>
                        <h4>Section ${index + 1}: ${section.title}</h4>
                    </div>
                    <div class="section-controls">
                        <span class="collapse-indicator" data-indicator="${section.id}">${isExpanded ? '‚ñº' : '‚ñ∂'}</span>
                        <button class="arrow-button" onclick="event.stopPropagation(); moveSection(${section.id}, -1)" ${isFirst ? 'disabled' : ''}>
                            ‚Üë
                        </button>
                        <button class="arrow-button" onclick="event.stopPropagation(); moveSection(${section.id}, 1)" ${isLast ? 'disabled' : ''}>
                            ‚Üì
                        </button>
                        <button class="button small secondary" onclick="event.stopPropagation(); toggleIconPicker(${section.id})">üé®</button>
                        <button class="button small danger" onclick="event.stopPropagation(); removeSection(${section.id})">Remove</button>
                    </div>
                </div>
                <div class="section-content ${isExpanded ? 'expanded' : ''}" data-section-content="${section.id}">
                    <div id="iconPicker-${section.id}" style="display: none;">
                        <div class="icon-picker">
                            ${availableIcons.map(icon => `
                                <div class="icon-option" onclick="selectIcon(${section.id}, '${icon}')">${icon}</div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Section Title</label>
                        <input type="text" value="${section.title}" onchange="updateSection(${section.id}, 'title', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Section Content</label>
                        <div class="text-toolbar">
                            <button class="toolbar-button" onclick="formatText(${section.id}, 'bold')" title="Bold">
                                <strong>B</strong>
                            </button>
                            <button class="toolbar-button" onclick="formatText(${section.id}, 'italic')" title="Italic">
                                <em>I</em>
                            </button>
                            <button class="toolbar-button" onclick="formatText(${section.id}, 'underline')" title="Underline">
                                <u>U</u>
                            </button>
                            <div class="toolbar-separator"></div>
                            <button class="toolbar-button" onclick="insertList(${section.id}, 'bullet')" title="Bullet List">
                                ‚Ä¢
                            </button>
                            <button class="toolbar-button" onclick="insertList(${section.id}, 'number')" title="Numbered List">
                                1.
                            </button>
                        </div>
                        <textarea id="sectionContent-${section.id}" rows="6" onchange="updateSection(${section.id}, 'content', this.value)">${section.content}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Section Image (optional)</label>
                        <input type="file" id="sectionImage-${section.id}" accept="image/*" style="display: none;" onchange="handleSectionImage(${section.id}, event)">
                        <div class="image-upload-area" onclick="document.getElementById('sectionImage-${section.id}').click()">
                            <span>üì∑ Click to upload image</span>
                        </div>
                        ${section.image ? `
                            <div class="section-image-preview">
                                <img src="${section.image}" alt="Section image" style="${getImageStyle(section.imageSize)}">
                                <div class="image-size-controls">
                                    <button class="size-button ${section.imageSize === 'small' ? 'active' : ''}" onclick="updateImageSize(${section.id}, 'small')">Small</button>
                                    <button class="size-button ${section.imageSize === 'medium' ? 'active' : ''}" onclick="updateImageSize(${section.id}, 'medium')">Medium</button>
                                    <button class="size-button ${section.imageSize === 'large' ? 'active' : ''}" onclick="updateImageSize(${section.id}, 'large')">Large</button>
                                    <button class="size-button ${section.imageSize === 'full' ? 'active' : ''}" onclick="updateImageSize(${section.id}, 'full')">Full Width</button>
                                </div>
                                <button class="button small danger" onclick="removeSectionImage(${section.id})" style="margin-top: 10px;">Remove Image</button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            container.appendChild(sectionDiv);
        }

        // Get image style based on size setting
        function getImageStyle(size) {
            switch(size) {
                case 'small':
                    return 'max-width: 300px; height: auto;';
                case 'medium':
                    return 'max-width: 500px; height: auto;';
                case 'large':
                    return 'max-width: 800px; height: auto;';
                case 'full':
                    return 'max-width: 100%; height: auto;';
                default:
                    return 'max-width: 500px; height: auto;';
            }
        }

        // Update image size
        function updateImageSize(sectionId, size) {
            const section = extractedData.sections.find(s => s.id === sectionId);
            if (section) {
                section.imageSize = size;
                populateSections();
                updatePreview();
            }
        }

        // Move section up or down
        function moveSection(sectionId, direction) {
            const currentIndex = extractedData.sections.findIndex(s => s.id === sectionId);
            const newIndex = currentIndex + direction;
            
            if (newIndex >= 0 && newIndex < extractedData.sections.length) {
                // Swap sections
                const temp = extractedData.sections[currentIndex];
                extractedData.sections[currentIndex] = extractedData.sections[newIndex];
                extractedData.sections[newIndex] = temp;
                
                populateSections();
                updatePreview();
            }
        }

        // Icon picker functions
        function toggleIconPicker(sectionId) {
            const picker = document.getElementById(`iconPicker-${sectionId}`);
            picker.style.display = picker.style.display === 'none' ? 'block' : 'none';
        }

        function selectIcon(sectionId, icon) {
            const section = extractedData.sections.find(s => s.id === sectionId);
            if (section) {
                section.icon = icon;
                document.getElementById(`icon-${sectionId}`).textContent = icon;
                toggleIconPicker(sectionId);
                updatePreview();
            }
        }

        // Image handling
        function handleSectionImage(sectionId, event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const section = extractedData.sections.find(s => s.id === sectionId);
                    if (section) {
                        section.image = e.target.result;
                        populateSections();
                        updatePreview();
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        function removeSectionImage(sectionId) {
            const section = extractedData.sections.find(s => s.id === sectionId);
            if (section) {
                section.image = null;
                populateSections();
                updatePreview();
            }
        }

        // Add new section
        function addSection() {
            const newSection = {
                id: Date.now(),
                title: 'New Section',
                content: 'Enter section content here...',
                icon: 'üìÑ',
                image: null,
                imageSize: 'medium'
            };
            extractedData.sections.push(newSection);
            expandedSections[newSection.id] = true;
            addSectionElement(newSection, extractedData.sections.length - 1);
            updatePreview();
        }

        // Remove section
        function removeSection(id) {
            extractedData.sections = extractedData.sections.filter(s => s.id !== id);
            delete expandedSections[id];
            populateSections();
            updatePreview();
        }

        // Update section
        function updateSection(id, field, value) {
            const section = extractedData.sections.find(s => s.id === id);
            if (section) {
                section[field] = value;
                if (field === 'title') {
                    // Update the title in the header
                    const header = document.querySelector(`[data-section-id="${id}"] .section-header h4`);
                    if (header) {
                        const index = extractedData.sections.findIndex(s => s.id === id);
                        header.textContent = `Section ${index + 1}: ${value}`;
                    }
                }
                updatePreview();
            }
        }

        // Show editor
        function showEditor() {
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('editorSection').style.display = 'block';
            updateStep(3);
            updatePreview();
        }

        // Device preview
        function setPreviewDevice(device) {
            currentDevice = device;
            const frame = document.getElementById('previewFrame');
            
            // Update button states
            document.querySelectorAll('.device-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update preview size
            frame.classList.remove('desktop', 'tablet', 'mobile');
            frame.classList.add(device);
        }

        // Update preview
        function updatePreview() {
            const iframe = document.getElementById('websitePreview');
            const fullPreview = document.getElementById('fullPreview');
            
            // Get current values
            extractedData.title = document.getElementById('posterTitle').value;
            extractedData.authors = document.getElementById('posterAuthors').value;
            extractedData.affiliations = document.getElementById('posterAffiliations').value;
            extractedData.conference = document.getElementById('conferenceDetails').value;
            extractedData.primaryColor = document.getElementById('primaryColor').value;
            extractedData.secondaryColor = document.getElementById('secondaryColor').value;
            extractedData.fontStyle = document.getElementById('fontStyle').value;
            extractedData.layoutStyle = document.getElementById('layoutStyle').value;
            extractedData.sectionTitleSize = parseInt(document.getElementById('sectionTitleSize').value);
            extractedData.sectionContentSize = parseInt(document.getElementById('sectionContentSize').value);
            extractedData.logoSize = parseInt(document.getElementById('logoSize').value);
            
            const html = generatePreviewHTML();
            iframe.srcdoc = html;
            if (fullPreview) {
                fullPreview.srcdoc = html;
            }
        }

        // Generate preview HTML
        function generatePreviewHTML() {
            const fontMap = {
                professional: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                academic: 'Georgia, "Times New Roman", serif',
                modern: '"Inter", -apple-system, BlinkMacSystemFont, sans-serif'
            };

            const isNavLayout = extractedData.layoutStyle === 'sections';

            const navHTML = isNavLayout ? `
                <nav style="position: fixed; top: 0; left: 0; right: 0; background: ${extractedData.secondaryColor}; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <div style="max-width: 1200px; margin: 0 auto; padding: 15px 40px; display: flex; justify-content: center; align-items: center;">
                        <div style="display: flex; gap: 30px;">
                            ${extractedData.sections.map((section, idx) => `
                                <a href="#section-${idx}" style="color: white; text-decoration: none; padding: 10px 20px; border-radius: 4px; transition: all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='transparent'">
                                    ${section.icon} ${section.title}
                                </a>
                            `).join('')}
                        </div>
                    </div>
                </nav>
            ` : '';

            // Process content to render HTML formatting
            const processContent = (content) => {
                return content
                    .replace(/\n/g, '<br>')
                    .replace(/‚Ä¢ /g, '<br>‚Ä¢ ')
                    .replace(/(\d+)\. /g, '<br>$1. ');
            };

            const sectionsHTML = extractedData.sections.map((section, idx) => `
                <div class="section" id="section-${idx}" style="scroll-margin-top: ${isNavLayout ? '80px' : '0'};">
                    <h2 style="font-size: ${extractedData.sectionTitleSize}px;">${section.icon} ${section.title}</h2>
                    <div style="font-size: ${extractedData.sectionContentSize}px;">${processContent(section.content)}</div>
                    ${section.image ? `<div style="text-align: center; margin-top: 20px;"><img src="${section.image}" style="${getImageStyle(section.imageSize || 'medium')} border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>` : ''}
                </div>
            `).join('');

            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        html { scroll-behavior: smooth; }
                        body {
                            font-family: ${fontMap[extractedData.fontStyle]};
                            line-height: 1.6;
                            color: #333;
                            background: #f5f5f5;
                            ${isNavLayout ? 'padding-top: 60px;' : ''}
                        }
                        .header {
                            background: ${extractedData.primaryColor};
                            color: white;
                            padding: 80px 40px;
                            text-align: center;
                        }
                        .container {
                            max-width: 1200px;
                            margin: 0 auto;
                            padding: 40px;
                        }
                        .content {
                            background: white;
                            padding: 60px;
                            border-radius: 12px;
                            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
                            margin-top: -40px;
                            position: relative;
                        }
                        h1 {
                            font-size: 42px;
                            margin-bottom: 20px;
                            line-height: 1.2;
                        }
                        .authors {
                            font-size: 20px;
                            opacity: 0.9;
                            margin-bottom: 15px;
                        }
                        .affiliations {
                            font-size: 16px;
                            opacity: 0.8;
                            max-width: 900px;
                            margin: 0 auto 20px;
                        }
                        .conference {
                            font-size: 14px;
                            opacity: 0.7;
                            margin-top: 20px;
                        }
                        .section {
                            margin-bottom: 50px;
                            padding: 40px;
                            background: #fafbfc;
                            border-radius: 8px;
                            transition: transform 0.3s;
                        }
                        .section:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
                        }
                        .section h2 {
                            color: ${extractedData.primaryColor};
                            margin-bottom: 25px;
                            border-bottom: 2px solid ${extractedData.primaryColor};
                            padding-bottom: 15px;
                        }
                        .section div {
                            line-height: 1.8;
                            color: #444;
                        }
                        
                        @media (max-width: 768px) {
                            .header { padding: 60px 20px; }
                            h1 { font-size: 32px; }
                            .container { padding: 20px; }
                            .content { padding: 30px; }
                            .section { padding: 25px; }
                            .section h2 { font-size: ${extractedData.sectionTitleSize * 0.75}px; }
                            ${isNavLayout ? `
                                nav > div { padding: 10px 20px; }
                                nav > div > div { 
                                    flex-wrap: wrap; 
                                    gap: 10px; 
                                    justify-content: center;
                                }
                                nav a { 
                                    font-size: 14px; 
                                    padding: 8px 12px;
                                }
                            ` : ''}
                        }
                        
                        @media (max-width: 480px) {
                            h1 { font-size: 28px; }
                            .authors { font-size: 16px; }
                            .content { padding: 20px; }
                            .section { padding: 20px; }
                            .section div { font-size: ${extractedData.sectionContentSize * 0.9}px; }
                        }
                    </style>
                </head>
                <body>
                    ${navHTML}
                    <div class="header">
                        <div class="container">
                            ${extractedData.logo ? `<img src="${extractedData.logo}" style="max-height: ${extractedData.logoSize}px; margin-bottom: 20px;">` : ''}
                            <h1>${extractedData.title || 'Your Poster Title'}</h1>
                            <div class="authors">${extractedData.authors || 'Authors'}</div>
                            <div class="affiliations">${extractedData.affiliations || 'Affiliations'}</div>
                            <div class="conference">${extractedData.conference || 'Conference Details'}</div>
                        </div>
                    </div>
                    <div class="container">
                        <div class="content">
                            ${sectionsHTML}
                        </div>
                    </div>
                </body>
                </html>
            `;
        }

        // Handle logo upload
        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    extractedData.logo = e.target.result;
                    document.getElementById('logoPreview').innerHTML = `<img src="${e.target.result}" alt="Logo">`;
                    document.getElementById('logoSizeGroup').style.display = 'block';
                    updatePreview();
                };
                reader.readAsDataURL(file);
            }
        }

        // Update color scheme
        function updateColorScheme() {
            const scheme = document.getElementById('colorScheme').value;
            const colors = colorSchemes[scheme];
            
            document.getElementById('primaryColor').value = colors.primary;
            document.getElementById('primaryColorHex').value = colors.primary;
            document.getElementById('secondaryColor').value = colors.secondary;
            document.getElementById('secondaryColorHex').value = colors.secondary;
            
            updatePreview();
        }

        // Update step
        function updateStep(step) {
            currentStep = step;
            for (let i = 1; i <= 4; i++) {
                const stepEl = document.getElementById(`step${i}`);
                if (i < step) {
                    stepEl.classList.add('complete');
                    stepEl.classList.remove('active');
                } else if (i === step) {
                    stepEl.classList.add('active');
                    stepEl.classList.remove('complete');
                } else {
                    stepEl.classList.remove('active', 'complete');
                }
            }
        }

        // Loading
        function showLoading(show) {
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }

        // Info modal
        function showInfo() {
            document.getElementById('infoModal').style.display = 'flex';
        }

        function closeInfo() {
            document.getElementById('infoModal').style.display = 'none';
        }

        // Preview modal
        function showPreviewModal() {
            updatePreview();
            document.getElementById('previewModal').style.display = 'flex';
        }

        function closePreviewModal() {
            document.getElementById('previewModal').style.display = 'none';
        }

        // Export
        function exportWebsite() {
            updateStep(4);
            document.getElementById('exportModal').style.display = 'flex';
        }

        function closeExportModal() {
            document.getElementById('exportModal').style.display = 'none';
        }

        function downloadWebsite() {
            const format = document.querySelector('input[name="exportFormat"]:checked').value;
            let code = '';
            let filename = '';
            
            if (format === 'html') {
                code = generatePreviewHTML();
                filename = 'poster-website.html';
            } else if (format === 'react') {
                code = generateReactComponent();
                filename = 'PosterWebsite.jsx';
            } else if (format === 'nextjs') {
                code = generateNextJSPage();
                filename = 'poster-page.js';
            }
            
            const blob = new Blob([code], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
            
            closeExportModal();
        }

        function generateReactComponent() {
            return `import React from 'react';

const PosterWebsite = () => {
    const data = ${JSON.stringify(extractedData, null, 2)};
    
    return (
        <div className="poster-website">
            ${extractedData.layoutStyle === 'sections' ? `
            <nav className="fixed-nav">
                <div className="nav-links">
                    {data.sections.map((section, idx) => (
                        <a key={idx} href={\`#section-\${idx}\`}>
                            {section.icon} {section.title}
                        </a>
                    ))}
                </div>
            </nav>` : ''}
            <header style={{ backgroundColor: data.primaryColor }}>
                {data.logo && <img src={data.logo} alt="Logo" />}
                <h1>{data.title}</h1>
                <p className="authors">{data.authors}</p>
                <p className="affiliations">{data.affiliations}</p>
                <p className="conference">{data.conference}</p>
            </header>
            <main>
                {data.sections.map((section, idx) => (
                    <section key={idx} id={\`section-\${idx}\`}>
                        <h2 style={{ fontSize: data.sectionTitleSize + 'px' }}>
                            {section.icon} {section.title}
                        </h2>
                        <div 
                            style={{ fontSize: data.sectionContentSize + 'px' }}
                            dangerouslySetInnerHTML={{ __html: section.content.replace(/\\n/g, '<br>') }}
                        />
                        {section.image && <img src={section.image} alt={section.title} />}
                    </section>
                ))}
            </main>
        </div>
    );
};

export default PosterWebsite;`;
        }

        function generateNextJSPage() {
            return `import Head from 'next/head';

export default function PosterPage() {
    const data = ${JSON.stringify(extractedData, null, 2)};
    
    return (
        <>
            <Head>
                <title>{data.title}</title>
                <meta name="description" content={data.title} />
            </Head>
            <div className="poster-website">
                ${extractedData.layoutStyle === 'sections' ? `
                <nav className="fixed-nav">
                    <div className="nav-links">
                        {data.sections.map((section, idx) => (
                            <a key={idx} href={\`#section-\${idx}\`}>
                                {section.icon} {section.title}
                            </a>
                        ))}
                    </div>
                </nav>` : ''}
                <header style={{ backgroundColor: data.primaryColor }}>
                    {data.logo && <img src={data.logo} alt="Logo" />}
                    <h1>{data.title}</h1>
                    <p className="authors">{data.authors}</p>
                    <p className="affiliations">{data.affiliations}</p>
                    <p className="conference">{data.conference}</p>
                </header>
                <main>
                    {data.sections.map((section, idx) => (
                        <section key={idx} id={\`section-\${idx}\`}>
                            <h2 style={{ fontSize: data.sectionTitleSize + 'px' }}>
                                {section.icon} {section.title}
                            </h2>
                            <div 
                                style={{ fontSize: data.sectionContentSize + 'px' }}
                                dangerouslySetInnerHTML={{ __html: section.content.replace(/\\n/g, '<br>') }}
                            />
                            {section.image && <img src={section.image} alt={section.title} />}
                        </section>
                    ))}
                </main>
            </div>
        </>
    );
}`;
        }

        // Navigation
        function goHome() {
            if (confirm('Are you sure you want to go home? You will lose any unsaved work.')) {
                location.reload();
            }
        }

        // Auto-save on input change
        document.addEventListener('input', function(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
                updatePreview();
            }
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>